<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <link rel="stylesheet" href="/stylesheets/style.css"/>
    <link rel="stylesheet" href="/css/template-editor.css"/>
    <link rel="stylesheet" type="text/css" href="/css/all.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="//sortablejs.github.io/Sortable/Sortable.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/trix/1.2.1/trix.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/trix/1.2.1/trix.js"></script>
    <!-- <script type="text/javascript" src="http://livejs.com/live.js"></script> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>
<body>
<div id="tmp-editor-cont" class = "templates">
    <header>
        <% include ../partials/header %>
    </header>
    <!-- start of bootstrap overhaul -->
    <p class="title"><%= title %></p>
    <div class="container py-3 my-3 section">
        <div class="row my-3 section">
            <div class="col d-flex align-items-center" >
                <div class="text-white">Template Name</div>
                <div class="ml-2 col-6">
                    <input type="text" class="form-control" value="<%= templateName %>" placeholder="e.g. Graduate School Recommendation Form"/>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container py-3 my-3 section">
        <div class="row">
            <div class="col-12 text-white">Custom Questions</div>
        </div>
        <div id="custom-questions-section questions-container">
            <div class="row d-flex align-items-center my-4">
                <div class="ml-4">
                    <img class="icon-effects\" src="/images/hamburger_white.svg">
                </div>
                <div class="col-5">
                    <input type="text" class="form-control" placeholder="e.g. What is your first name?"/>
                </div>
                <div class="col-2">
                    <select class="form-control" id="exampleFormControlSelect1">
                        <option>Text Answer</option>
                        <option>Radio Button</option>
                        <option>Checkbox</option>
                    </select>
                </div>
                <div class="d-flex align-items-center">
                    <span class="text-white mr-2">Required?</span>
                    <input type="checkbox" class="big-checkbox">
                </div>
                <div class="col-3">
                    <input type="text" class="form-control" placeholder="tag (e.g. #fname)"/>
                </div>
            </div>


            <div class="row d-flex align-items-center">
                <div class="ml-4">
                    <img class="icon-effects\" src="/images/hamburger_white.svg">
                </div>
                <div class="col-5">
                    <input type="text" class="form-control" placeholder="e.g. What is your first name?"/>
                </div>
                <div class="col-2">
                    <select class="form-control" id="exampleFormControlSelect1">
                        <option>Text Answer</option>
                        <option>Radio Button</option>
                        <option>Checkbox</option>
                    </select>
                </div>
                <div class="d-flex align-items-center">
                    <span class="text-white mr-2">Required?</span>
                    <input type="checkbox" class="big-checkbox">
                </div>
                <div class="col-3">
                    <input type="text" class="form-control" placeholder="tag (e.g. #fname)"/>
                </div>
            </div>


            <div class="row d-flex align-items-center my-4">
                <div class="ml-4">
                    <img class="icon-effects\" src="/images/hamburger_white.svg">
                </div>
                <div class="col-5">
                    <input type="text" class="form-control" placeholder="e.g. What is your first name?"/>
                </div>
                <div class="col-2">
                    <select class="form-control" id="exampleFormControlSelect1">
                        <option>Text Answer</option>
                        <option>Radio Button</option>
                        <option>Checkbox</option>
                    </select>
                </div>
                <div class="d-flex align-items-center">
                    <span class="text-white mr-2">Required?</span>
                    <input type="checkbox" class="big-checkbox">
                </div>
                <div class="col-3">
                    <input type="text" class="form-control" placeholder="tag (e.g. #fname)"/>
                </div>
            </div>
        </div>
        <div class="row dflex">
            <div class="ml-4">
                <img id="add-question" class="icon-effects\" src="images/plus.png">
            </div>
        </div>
    </div>

    <!-- letter boilerplate -->
    <div class="container py-3 my-3 section">
        <div class="row">
            <div class="col-12 text-white">Letter Boilerplate</div>
        </div>
        <div class="row bg-light m-3 p-3 ">
            <div id='tags' class="d-flex align-items-center m-3 p-3">
                <div class="col-1">
                    <span>Tags: </span>
                </div>
                <div class="col-11 d-flex">
                    <div>
                        <button class="btn btn-outline-dark mr-3">#FNAME</button>
                        <button class="btn btn-outline-dark mr-3">#LNAME</button>
                        <button class="btn btn-outline-dark mr-3">#SUB_PRONOUN</button>
                        <button class="btn btn-outline-dark mr-3">#OBJ_PRONOUN</button>
                        <button class="btn btn-outline-dark mr-3">#OBJ_PRONOUN</button>
                        <!-- <button class="btn btn-outline-dark m-3">#OBJ_PRONOUN</button> -->
                        <!-- <button class="btn btn-outline-dark m-3">#OBJ_PRONOUN</button> -->
                        <!-- <button class="btn btn-outline-dark m-3">#OBJ_PRONOUN</button> -->
                        <!-- <button class="btn btn-outline-dark m-3">#OBJ_PRONOUN</button> -->
                    </div>
                </div>
            </div>
            <!-- <div class="col col-1">Template:</div> -->
            <div class="col col-12 error-container my-5">
                <div id="letter-container" class="">
                    <div class="">
                        <trix-editor class="trix-content" id="letter-text-area"></trix-editor>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- end of bootstrap overhaul -->
    <p class="title"><%= title %></p>
    <div id="template-editor-container">
        <div class="error-container">
            <div id="name-container">
                <h2 class="section-header">Template Name</h2>
                <input type="text" class="text-field" placeholder="Enter a template name here..."
                       value="<%= templateName %>"/>
            </div>
        </div>

        <h2 id="custom-questions" class="section-header">Custom Questions</h2>
        <button class="large-circle-button" onclick="addQuestion()">+ Add question</button>
        <div id="questions-container"></div>

        <div class="flex-display all-tags-cont">
            <h2 id="tags-heading-main" class="section-header">Tags</h2>
            <div class="flex1">
                <p id="tag-heading">&lt!TAG_NAME&gt in the letter will be replaced by the corresponding question's answer.
                    Tags can be nested in the replacement text of other questions.</p>
                <p id="tags-heading">All Tags: </p>
                <div id="tag-container">
                    <% for (var q=0; q < questions.length; q++) { %>
                        <% let options = questions[q].options; %>
                        <% if(options) { %>
                            <% for (var o=0; o < options.length; o++) { %>
                                <% if(options[o].tag) { %>
                                    <button class="popup"  name="tag_buttons" value ="<%= options[o].tag %>"><%= options[o].tag %>
                                        <span class="popup-text">
                                            <%= questions[q].question %>
                                        </span>
                                    </button>
                                <% } %>
                            <% } %>
                        <% } %>
                        <% if(!options || questions[q].type === "Text" || questions[q].type === "Radio Button") { %>
                            <button class="popup"  name="tag_buttons" value ="<%= questions[q].tag %>"><%= questions[q].tag %>
                                <span class="popup-text">
                                    <%= questions[q].question %>
                                </span>
                            </button>
                        <% } %>
                    <% } %>
                    <br/>
                </div>
                <br>

            </div>
        </div>

        <div class="error-container">
            <div id="letter-container">
                <h2 id="letter-boilerplate" class="section-header">Letter Boilerplate</h2>
                <div class="flex1">
                    <trix-editor class="trix-content" id="letter-text-area"></trix-editor>
                </div>
            </div>
        </div>

        <script>
        function sendFile(){
        // Form Data
        var formData = new FormData();

        var fileSelect = document.getElementById("template-upload-file");
        if(fileSelect.files && fileSelect.files.length == 1){
        var file = fileSelect.files[0]
        formData.set("file", file , file.name);
        }

        // Http Request
        var request = new XMLHttpRequest();
        request.open('POST', "/template-dashboard/uploadLetterTemplate");
        request.send(formData);

        //Submit success
        alert('template uploaded');
        //location.reload();
        }
        </script>
        <div class="flex-display upload-cont">
          <h2 id="upload-template" class="section-header">Apply Body Text to Custom Template </h2>
          <div class="upload-preview-container flex1">
            <form encType="multipart/form-data">
              <input type="file" id="template-upload-file" />
              <button type="button" onclick="sendFile()">Upload</button>
            </form>
          </div>
        </div>

        <br/><br/>
        <%  if (typeof saveSwitch == "boolean") {
            if(saveSwitch){%>
            <div class="flex-row">
                <button id="save-button" onclick="saveTemplate()">Save</button>
            </div>
        <% }} else if (typeof saveSwitch == "string") {
                if (saveSwitch == "true"){%>
            <div class="flex-row">
                <button id="save-button" onclick="saveTemplate()">Save</button>
            </div>
        <% }} %>
    </div>
</div>

<script type="text/javascript" src="/javascripts/template-editor.js" id="<%= id %>"
            letterheadImgData="<%= letterheadImage %>" footerImgData="<%= footerImage %>" saveSwitchData="<%= saveSwitch %>"></script>
<script type="text/javascript" src="/javascripts/template-editor-tags.js"></script>
</body>

<div id="add-question-modal">
    <div class="content">  
        <div class="flex-row">
            <h1>Select Question Type</h1>
        </div>
        <div class="flex-row option-cont">
            <button onclick="addTextAnswerQuestion()">Text Answer</button>
        </div>
        <div class="line"></div>
        <div class="flex-row option-cont">
            <button onclick="addRadioButtonQuestion()">Radio Button</button>
        </div>
        <div class="line"></div>
        <div class="flex-row option-cont">
            <button onclick="addCheckboxQuestion()">Checkbox</button>
        </div>
    </div>
</div>

<div id="warning-modal">
    <div class="content">
        <div class="flex-row">
            <h1>Are you sure?</h1>
        </div>
        <div class="flex-row">
            <button onclick="executeWarningModalFunction()">Yes</button>
            <button onclick="hideWarningModal()">No</button>
        </div>
    </div>
</div>
</html>
